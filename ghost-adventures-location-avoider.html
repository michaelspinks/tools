<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ghost Adventures — Location Avoider</title>
  <style>
    /*
      Theme model:
      - Light or Dark only (no system mode)
      - First load defaults to your OS preference, then persists via localStorage
    */
    html { color-scheme: light dark; }
    html[data-theme="light"] { color-scheme: light; }
    html[data-theme="dark"] { color-scheme: dark; }

    :root {
      --bg: #ffffff;
      --fg: #111111;
      --card: #ffffff;
      --border: rgba(0,0,0,.15);
      --border2: rgba(0,0,0,.10);
      --muted: rgba(0,0,0,.68);
      --muted2: rgba(0,0,0,.55);
      --focus: rgba(0, 120, 215, .9);
      --focusShadow: rgba(0, 120, 215, .15);
    }

    html[data-theme="light"]:root {
      --bg: #ffffff;
      --fg: #111111;
      --card: #ffffff;
      --border: rgba(0,0,0,.15);
      --border2: rgba(0,0,0,.10);
      --muted: rgba(0,0,0,.68);
      --muted2: rgba(0,0,0,.55);
    }

    html[data-theme="dark"]:root {
      --bg: #0b0b0c;
      --fg: #f5f5f7;
      --card: #111114;
      --border: rgba(255,255,255,.18);
      --border2: rgba(255,255,255,.12);
      --muted: rgba(245,245,247,.75);
      --muted2: rgba(245,245,247,.60);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.35;
      background: var(--bg);
      color: var(--fg);
    }

    header {
      padding: 16px 18px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 10;
    }

    h1 { margin: 0 0 6px; font-size: 18px; }
    .sub { margin: 0; opacity: .9; color: var(--muted); font-size: 13px; }

    .header-actions {
      position: absolute;
      right: 18px;
      top: 14px;
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }

    .header-actions button {
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 12px;
    }

    @media (max-width: 520px) {
      .header-actions { position: static; margin-top: 10px; justify-content: center; }
    }

    main { padding: 16px 18px 28px; max-width: 1100px; margin: 0 auto; }

    .controls {
      display: grid;
      grid-template-columns: 1.2fr .9fr .9fr auto;
      gap: 10px;
      align-items: end;
      margin-bottom: 12px;
    }

    label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 10px 11px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--fg);
      outline: none;
    }

    input[type="text"]::placeholder, textarea::placeholder { color: var(--muted2); }

    input[type="text"]:focus, select:focus, textarea:focus {
      border-color: var(--focus);
      box-shadow: 0 0 0 3px var(--focusShadow);
    }

    button {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--fg);
      cursor: pointer;
      white-space: nowrap;
    }

    button[disabled] { opacity: .6; cursor: not-allowed; }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px); }

    .row {
      display: grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 12px;
      align-items: start;
      margin-top: 14px;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      background: var(--card);
    }

    .meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin: 8px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      text-align: left;
      padding: 10px 8px;
      border-bottom: 1px solid var(--border2);
      vertical-align: top;
      font-size: 13px;
    }

    /* Sticky within the scroll container */
    th { position: sticky; top: 0; background: var(--card); z-index: 5; }

    .pill {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      padding: 3px 8px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      background: transparent;
    }

    .muted { color: var(--muted); }
    .nowrap { white-space: nowrap; }

    .toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
      align-items: center;
    }

    .avoid-list {
      display: grid;
      gap: 10px;
    }

    .avoid-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .small {
      font-size: 12px;
      color: var(--muted);
    }

    .banner-error {
      margin-top: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: transparent;
      color: var(--muted);
      font-size: 12px;
    }

    @media (max-width: 900px) {
      .controls { grid-template-columns: 1fr 1fr; }
      .controls .full { grid-column: 1 / -1; }
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Ghost Adventures — Location Avoider</h1>
    <p class="sub">Search the investigation locations list (from the dataset gathered in this chat) and build a personal “avoid staying here” list for holidays.</p>
    <div class="header-actions">
      <button id="themeBtn" type="button" title="Toggle light/dark">Theme: Light</button>
    </div>
  </header>

  <main>
    <section class="controls">
      <div class="full">
        <label for="q">Search (city, site, country, state/region)</label>
        <input id="q" type="text" placeholder="e.g., ‘Edinburgh’, ‘Catacombs’, ‘Nevada’, ‘Waverly’" autocomplete="off" />
      </div>

      <div>
        <label for="country">Country</label>
        <select id="country"></select>
      </div>

      <div>
        <label for="state">State / Region</label>
        <select id="state"></select>
      </div>

      <div>
        <button id="clear" title="Clear search & filters">Clear</button>
      </div>
    </section>

    <section class="toolbar">
      <span class="pill"><strong id="matchCount">0</strong> matches</span>
      <span class="pill"><strong id="totalCount">0</strong> locations</span>
      <label class="pill" style="cursor:pointer;">
        <input id="exact" type="checkbox" style="margin:0 6px 0 0;"> Exact-ish match
      </label>
      <span class="small">Tip: “Exact-ish” requires full-word matches (good for city names).</span>
    </section>

    <div id="errorBanner" class="banner-error" style="display:none;"></div>

    <div class="row">
      <section class="card" aria-label="Results">
        <div class="muted" style="margin-bottom:10px; font-size:12px;">
          Click <span class="nowrap">“Avoid”</span> to add an entry to your holiday avoid list.
        </div>
        <div style="max-height: 62vh; overflow:auto; border-radius: 10px;">
          <table>
            <thead>
              <tr>
                <th style="width: 20%;">Country</th>
                <th style="width: 18%;">State/Region</th>
                <th style="width: 18%;">City/Town</th>
                <th>Site</th>
                <th style="width: 90px;"></th>
              </tr>
            </thead>
            <tbody id="results"></tbody>
          </table>
        </div>
      </section>

      <aside class="card" aria-label="Avoid list">
        <h2 style="margin:0 0 8px; font-size:16px;">My avoid list</h2>
        <p class="small" style="margin:0 0 10px;">Use this as a quick “don’t-book-here” checklist when planning travel.</p>

        <div class="avoid-list">
          <textarea id="avoidText" rows="10" placeholder="Your avoided places will appear here…"></textarea>
          <div class="avoid-actions">
            <button id="copy">Copy</button>
            <button id="download">Download CSV</button>
            <button id="resetAvoid">Reset</button>
          </div>
          <div class="small">
            The avoid list is stored in your browser (localStorage) so it persists if you reopen this file.
          </div>
        </div>
      </aside>
    </div>

    <section class="card" style="margin-top: 14px;">
      <h2 style="margin:0 0 8px; font-size:16px;">Check a destination quickly</h2>
      <div class="controls" style="grid-template-columns: 1.2fr auto; margin: 0;">
        <div>
          <label for="check">Destination you’re considering</label>
          <input id="check" type="text" placeholder="e.g., ‘Las Vegas’, ‘Jerome Grand Hotel’, ‘Wexford’" />
        </div>
        <div>
          <button id="runCheck">Check</button>
        </div>
      </div>
      <div id="checkOut" class="meta"></div>
    </section>

    <p class="small" style="margin-top: 14px;">
      Data note: this list is based on the locations gathered earlier in this chat (derived from the episode/special “Location(s)” field). It may include duplicates (revisits/recaps) and occasional formatting quirks from the source.
    </p>
  </main>

  <script>
    // =========================
    // DATA
    // Format: [country, stateOrRegion, cityOrTown, site]
    // =========================
    const RAW = [
      // Format: [country, stateOrRegion, cityOrTown, site]

      // CANADA
      ["Canada", "Ontario", "Fort Erie", "Olde Fort Erie"],

      // FRANCE
      ["France", "Ile-de-France", "Paris", "Netherworld Paris Catacombs"],

      // IRELAND
      ["Ireland", "County Dublin", "Montpelier Hill", "Ireland's Celtic Demons"],
      ["Ireland", "County Offaly", "Clareen", "Ireland's Celtic Demons"],
      ["Ireland", "County Wexford", "Duncannon", "Ireland's Celtic Demons"],

      // ITALY
      ["Italy", "Veneto", "Venice", "Poveglia Island"],

      // JAMAICA
      ["Jamaica", "St. James Parish", "Montego Bay", "Rose Hall"],

      // MEXICO
      ["Mexico", "Mexico City", "Xochimilco", "Island of Dolls"],

      // ROMANIA
      ["Romania", "Cluj", "Cluj-Napoca", "Halloween Special Transylvania"],
      ["Romania", "Dâmbovița", "Târgoviște", "Halloween Special Transylvania"],
      ["Romania", "Hunedoara", "Hunedoara", "Halloween Special Transylvania"],

      // UNITED KINGDOM
      ["UK", "England", "Chatham", "Fort Horsted"],
      ["UK", "England", "Gillingham", "Fort Horsted"],
      ["UK", "England", "West Wycombe", "Hellfire Caves"],
      ["UK", "England", "Wotton-under-Edge", "Ancient Ram Inn"],
      ["UK", "Scotland", "Edinburgh", "Edinburgh Vaults"],

      // UNITED STATES
      // Alabama
      ["US", "Alabama", "Birmingham", "Sloss Furnaces"],

      // Arizona
      ["US", "Arizona", "Apache Junction", "Apache Junction"],
      ["US", "Arizona", "Ajo", "Phelps Dodge Hospital"],
      ["US", "Arizona", "Bisbee", "The Copper Queen Hotel and The Oliver House"],
      ["US", "Arizona", "Buckeye", "Stardust Ranch"],
      ["US", "Arizona", "Casa Grande", "The Domes"],
      ["US", "Arizona", "Flagstaff", "Fear in Flagstaff"],
      ["US", "Arizona", "Globe", "Bloodshed in the Bordello"],
      ["US", "Arizona", "Globe", "Old Gila County Jail and Courthouse"],
      ["US", "Arizona", "Jerome", "Jerome Grand Hotel"],
      ["US", "Arizona", "Kingman", "Lost Souls of Kingman"],
      ["US", "Arizona", "Lake Havasu City", "London Bridge"],
      ["US", "Arizona", "Miami", "Old Bullion Plaza School"],
      ["US", "Arizona", "Oracle", "Acadia Ranch Sanatorium"],
      ["US", "Arizona", "Peach Springs", "Grand Canyon Caverns"],
      ["US", "Arizona", "Phoenix", "Hotel San Carlos"],
      ["US", "Arizona", "Prescott", "Palace Saloon"],
      ["US", "Arizona", "Scottsdale", "A Haunting in Scottsdale"],
      ["US", "Arizona", "Tempe", "Terror in Tempe"],
      ["US", "Arizona", "Tombstone", "Birdcage Theater"],
      ["US", "Arizona", "Tombstone", "Return to Tombstone"],
      ["US", "Arizona", "Tucson", "Hotel Congress"],
      ["US", "Arizona", "Tucson", "The Slaughter House"],
      ["US", "Arizona", "Vulture City", "Disturbed in Wickenburg"],
      ["US", "Arizona", "Wickenburg", "Vulture Mine"],
      ["US", "Arizona", "Yuma", "Hell Hole Prison"],
      ["US", "Arizona", "Yuma", "Lutes Casino"],

      // Arkansas
      ["US", "Arkansas", "Eureka Springs", "Crescent Hotel"],
      ["US", "Arkansas", "Fort Smith", "Fort Chaffee"],

      // California
      ["US", "California", "Alameda", "USS Hornet"],
      ["US", "California", "Altadena", "The Woodbury Home of American Horror Story"],
      ["US", "California", "Antelope", "Nightmare in Antelope"],
      ["US", "California", "Avalon", "Curse of Catalina Island"],
      ["US", "California", "Benicia", "Union Hotel"],
      ["US", "California", "Big Sur", "Point Sur Lighthouse"],
      ["US", "California", "Biggs", "Horror in Biggs"],
      ["US", "California", "Brookdale", "Brookdale Lodge"],
      ["US", "California", "Calabasas", "King Gillette Ranch"],
      ["US", "California", "Calico", "Condemned in Calico"],
      ["US", "California", "Capitola", "Mystery of Rispin Mansion"],
      ["US", "California", "Carmel", "Tor House"],
      ["US", "California", "Clovis", "Clovis Wolfe Manor"],
      ["US", "California", "Death Valley Junction", "Amargosa Opera House"],
      ["US", "California", "Death Valley National Park", "Scotty's Castle"],
      ["US", "California", "Deming", "Lewis Flats School"],
      ["US", "California", "Downey", "Ghost Adventures Devil's Den"],
      ["US", "California", "Downey", "Hollydale Asylum of Hell"],
      ["US", "California", "Elk Grove", "Emergency in Elk Grove"],
      ["US", "California", "Fontana", "Terror in Fontana"],
      ["US", "California", "Goleta", "Stow House Haunting"],
      ["US", "California", "Hollywood", "Haunting in the Hills"],
      ["US", "California", "Hollywood", "Living Dead on La Brea"],
      ["US", "California", "Hollywood", "Ripley's Believe It or Not"],
      ["US", "California", "Hollywood", "Terror at the Toy Shop"],
      ["US", "California", "Ione", "Preston Castle"],
      ["US", "California", "Jackson", "Kennedy Mine"],
      ["US", "California", "Jamestown", "Gold Town Terror"],
      ["US", "California", "Joshua Tree", "The Joshua Tree Inn"],
      ["US", "California", "Keeler", "Cerro Gordo Ghost Town"],
      ["US", "California", "La Crescenta", "Mountain Oaks Mayhem"],
      ["US", "California", "Lake Arrowhead", "Bracken Fern Manor/Tudor House"],
      ["US", "California", "Lancaster", "Lockdown in Lancaster"],
      ["US", "California", "Lompoc", "La Purisima Mission"],
      ["US", "California", "Long Beach", "Queen Mary"],
      ["US", "California", "Los Angeles", "Black Dahlia House"],
      ["US", "California", "Los Angeles", "Fort MacArthur Museum"],
      ["US", "California", "Los Angeles", "Freak Show Murder House"],
      ["US", "California", "Los Angeles", "Ghost Adventures Cecil Hotel"],
      ["US", "California", "Los Angeles", "Haunted Hollywood"],
      ["US", "California", "Los Angeles", "Hotel Barclay"],
      ["US", "California", "Los Angeles", "LA Hospital of Horror"],
      ["US", "California", "Los Angeles", "LA Police Station Invasion"],
      ["US", "California", "Los Angeles", "Linda Vista Hospital"],
      ["US", "California", "Los Angeles", "Los Feliz Murder House Part 1"],
      ["US", "California", "Los Angeles", "Los Feliz Murder House Part 2"],
      ["US", "California", "Los Angeles", "Manor of Malice"],
      ["US", "California", "Los Angeles", "Nightmare at the Roxie"],
      ["US", "California", "Los Angeles", "Nightmare in Northridge"],
      ["US", "California", "Los Angeles", "Orcutt Ranch"],
      ["US", "California", "Los Angeles", "Pico House Hotel"],
      ["US", "California", "Los Angeles", "Reseda House of Evil"],
      ["US", "California", "Los Angeles", "Secret Scientology Lab"],
      ["US", "California", "Los Angeles", "Sharon Tate Ghost/The Oman House"],
      ["US", "California", "Los Angeles", "Silent Movie Theater"],
      ["US", "California", "Los Angeles", "The Beast of West Hills"],
      ["US", "California", "Los Angeles", "The Comedy Store"],
      ["US", "California", "Los Angeles", "Village of Lost Souls"],
      ["US", "California", "Mentryville", "Mentryville Ghost Town"],
      ["US", "California", "Mokelumne Hill", "Hotel Léger"],
      ["US", "California", "Montecito", "Montecito Mansion of Mystery"],
      ["US", "California", "Nevada City", "The National Hotel"],
      ["US", "California", "North Hollywood", "The Alley of Darkness"],
      ["US", "California", "Oakdale", "Crisis in Oakdale"],
      ["US", "California", "Ontario", "The Graber Farm Entity"],
      ["US", "California", "Oxnard", "Vengeance in Oxnard"],
      ["US", "California", "Pacific Grove", "Pacific Grove Nightmare"],
      ["US", "California", "Pasadena", "Hospital of the Damned"],
      ["US", "California", "Pasadena", "Pasadena Ritual House"],
      ["US", "California", "Paso Robles", "Panic on Pine Street"],
      ["US", "California", "Porterville", "Zalud House"],
      ["US", "California", "Riverside", "Riverside Plane Graveyard"],
      ["US", "California", "Sacramento", "Dorothea Puente Murder House"],
      ["US", "California", "Sacramento", "Sacramento Tunnels"],
      ["US", "California", "Salinas", "Old Stage Road"],
      ["US", "California", "Salinas", "Steinbeck House Haunting"],
      ["US", "California", "San Diego", "Darkness of Belmont Park"],
      ["US", "California", "San Diego", "Lost Souls of the Berkeley"],
      ["US", "California", "San Diego", "Old Town San Diego"],
      ["US", "California", "San Diego", "Star of India"],
      ["US", "California", "San Diego", "Whaley House"],
      ["US", "California", "San Francisco", "Albion Castle"],
      ["US", "California", "San Francisco", "Alcatraz"],
      ["US", "California", "San Francisco", "Market Street Cinema"],
      ["US", "California", "San Francisco", "Westerfeld House"],
      ["US", "California", "San Jose", "The Houdini Seance"],
      ["US", "California", "San Jose", "Return to Winchester Mystery House"],
      ["US", "California", "San Jose", "Winchester Mystery House"],
      ["US", "California", "Santa Ana", "Yost Theater & Ritz Hotel"],
      ["US", "California", "Santa Clarita", "Heritage Junction"],
      ["US", "California", "Santa Paula", "Glen Tavern Inn"],
      ["US", "California", "Santa Paula", "Glen Tavern Tragedy"],
      ["US", "California", "Simi Valley", "Ghost Adventures Poltergeist House Curse"],
      ["US", "California", "Soledad", "Los Coches Adobe"],
      ["US", "California", "Sonora", "Tuolumne General Hospital"],
      ["US", "California", "Tiburon", "Ghost Adventures Devil Island"],
      ["US", "California", "Walnut Grove", "Chinese Town of Locke"],
      ["US", "California", "West Hollywood", "The Viper Room"],

      // Colorado
      ["US", "Colorado", "Cripple Creek", "Cripple Creek"],
      ["US", "Colorado", "Denver", "Peabody-Whitehead Mansion"],
      ["US", "Colorado", "Erie", "Exorcism in Erie"],
      ["US", "Colorado", "Estes Park", "Stanley Hotel"],
      ["US", "Colorado", "Florissant", "Piotrowski House"],
      ["US", "Colorado", "Grand Junction", "Melrose Hotel"],
      ["US", "Colorado", "Idaho Springs", "Colorado Gold Mine"],
      ["US", "Colorado", "Montrose", "Museum of the Mountain West"],

      // Connecticut
      ["US", "Connecticut", "Bridgeport", "Remington Arms Factory"],
      ["US", "Connecticut", "Granby", "The Galka Family"],

      // Florida
      ["US", "Florida", "Royal Palm Beach", "The Riddle House"],
      ["US", "Florida", "St. Augustine", "Castillo De San Marcos"],

      // Georgia
      ["US", "Georgia", "Savannah", "Haunted Savannah"],
      ["US", "Georgia", "Savannah", "Moon River Brewing Company"],

      // Idaho
      ["US", "Idaho", "Albion", "Albion Normal School"],
      ["US", "Idaho", "Boise", "Idaho State Penitentiary"],
      ["US", "Idaho", "Gooding", "Idaho State Tuberculosis Hospital"],
      ["US", "Idaho", "Lava Hot Springs", "Lava Hot Springs Inn"],
      ["US", "Idaho", "St. Anthony", "Idaho State Reform School"],

      // Illinois
      ["US", "Illinois", "Alton", "Curse of the River Bend McPike Mansion"],
      ["US", "Illinois", "Ashmore", "Ashmore Estates"],
      ["US", "Illinois", "Chicago", "Excalibur Nightclub"],
      ["US", "Illinois", "Joliet", "Serial Killer Spirits John Gacy Prison"],

      // Indiana
      ["US", "Indiana", "Carmel", "Fox Hollow Farm"],
      ["US", "Indiana", "Greenfield", "Black Moon Manor"],
      ["US", "Indiana", "Irvington", "Serial Killer Spirits H.H. Holmes Murder House"],
      ["US", "Indiana", "New Castle", "Thornhaven Manor"],

      // Iowa
      ["US", "Iowa", "Council Bluffs", "Serial Killer Spirits Axe Killer Jail"],
      ["US", "Iowa", "Scotch Grove", "Edinburgh Manor"],
      ["US", "Iowa", "Villisca", "Villisca Axe Murder House"],

      // Kansas
      ["US", "Kansas", "Atchison", "Sallie House"],

      // Kentucky
      ["US", "Kentucky", "Harrodsburg", "Rocky Point Manor"],
      ["US", "Kentucky", "Louisville", "Waverly Hills Sanatorium"],
      ["US", "Kentucky", "Maysville", "Kentucky Slave House"],
      ["US", "Kentucky", "Perryville", "Battle of Perryville Field Hospitals"],
      ["US", "Kentucky", "Perryville", "Perryville Battlefield"],
      ["US", "Kentucky", "Wilder", "Bobby Mackey's Music World"],

      // Louisiana
      ["US", "Louisiana", "Natchitoches", "Magnolia Plantation"],
      ["US", "Louisiana", "New Orleans", "New Orleans"],
      ["US", "Louisiana", "St. Francisville", "The Myrtles Plantation"],

      // Massachusetts
      ["US", "Massachusetts", "Fall River", "Lizzie Borden House"],
      ["US", "Massachusetts", "Gardner", "Haunted Victorian Mansion"],
      ["US", "Massachusetts", "North Adams", "Houghton Mansion"],
      ["US", "Massachusetts", "Salem", "Salem Witch House and Lyceum Restaurant"],
      ["US", "Massachusetts", "Sudbury", "Longfellow's Wayside Inn"],
      ["US", "Massachusetts", "Sudbury", "Valentine's Day Special"],

      // Minnesota
      ["US", "Minnesota", "Duluth", "Nopeming Sanatorium"],
      ["US", "Minnesota", "Sauk Centre", "The Palmer House"],

      // Mississippi
      ["US", "Mississippi", "Bolton", "Hauntings of Vicksburg Champion Hill Battlefield"],
      ["US", "Mississippi", "Natchez", "Kings Tavern"],
      ["US", "Mississippi", "Vicksburg", "Hauntings of Vicksburg McRaven Mansion"],

      // Missouri
      ["US", "Missouri", "Bel-Nor", "The Exorcist House"],
      ["US", "Missouri", "Branson", "The Titanic Museum"],
      ["US", "Missouri", "Jefferson City", "Missouri State Penitentiary"],
      ["US", "Missouri", "Kansas City", "Union Station"],
      ["US", "Missouri", "Liberty", "Odd Fellows Asylum"],
      ["US", "Missouri", "Springfield", "Pythian Castle"],
      ["US", "Missouri", "St. Louis", "Lemp Mansion"],

      // Montana
      ["US", "Montana", "Butte", "Dumas Brothel"],
      ["US", "Montana", "Deer Lodge", "Old Montana State Prison"],
      ["US", "Montana", "Dillon", "Bannack Ghost Town"],
      ["US", "Montana", "Dillon", "Hotel Metlen"],
      ["US", "Montana", "Twin Bridges", "Twin Bridges Orphanage"],

      // Nevada
      ["US", "Nevada", "Belmont", "Belmont Ghost Town"],
      ["US", "Nevada", "Blue Diamond", "Bonnie Spring Ranch"],
      ["US", "Nevada", "Carson City", "Nevada State Prison"],
      ["US", "Nevada", "Clark", "Mustang Ranch"],
      ["US", "Nevada", "Clark County", "Ghost Adventures Lake of Death"],
      ["US", "Nevada", "Elko", "Abandoned in Elko"],
      ["US", "Nevada", "Ely", "Ghost Train of Ely"],
      ["US", "Nevada", "Eureka", "Eureka Mining Town"],
      ["US", "Nevada", "Goldfield", "Ghost Adventures Documentary Film"],
      ["US", "Nevada", "Goldfield", "Ghost Adventures Goldfield Hotel"],
      ["US", "Nevada", "Goldfield", "Goldfield High School"],
      ["US", "Nevada", "Goldfield", "Goldfield Hotel"],
      ["US", "Nevada", "Goodsprings", "Pioneer Saloon"],
      ["US", "Nevada", "Henderson", "Henderson Hell House"],
      ["US", "Nevada", "Las Vegas", "Binion's Hotel and Casino"],
      ["US", "Nevada", "Las Vegas", "Curse of Ranch Island"],
      ["US", "Nevada", "Las Vegas", "Doll of Fire"],
      ["US", "Nevada", "Las Vegas", "Gates of Hell House"],
      ["US", "Nevada", "Las Vegas", "Goodwin Home Invasion"],
      ["US", "Nevada", "Las Vegas", "Halloween Special Museum of Madness"],
      ["US", "Nevada", "Las Vegas", "Halloween Special The Haunted Museum LIVE"],
      ["US", "Nevada", "Las Vegas", "House of Brujeria"],
      ["US", "Nevada", "Las Vegas", "La Palazza Mansion"],
      ["US", "Nevada", "Las Vegas", "Madame Tussauds Wax Museum"],
      ["US", "Nevada", "Las Vegas", "Midnight at the Museum"],
      ["US", "Nevada", "Las Vegas", "Palomino Club"],
      ["US", "Nevada", "Las Vegas", "Return to the Riviera"],
      ["US", "Nevada", "Las Vegas", "Sin City Exorcism"],
      ["US", "Nevada", "Las Vegas", "The Chinatown Poltergeist"],
      ["US", "Nevada", "Las Vegas", "The Haunted Museum"],
      ["US", "Nevada", "Las Vegas", "The Riviera Hotel"],
      ["US", "Nevada", "Lovelock", "Lovelock Triangle"],
      ["US", "Nevada", "Pahrump", "Petrified in Pahrump"],
      ["US", "Nevada", "Pioche", "Mount Wilson Ranch"],
      ["US", "Nevada", "Pioche", "Overland Hotel and Saloon"],
      ["US", "Nevada", "Pioche", "Pioche Hospital of Hell"],
      ["US", "Nevada", "Primm", "Abandoned at Whiskey Pete's"],
      ["US", "Nevada", "Reno", "Rage on the River"],
      ["US", "Nevada", "Sandy Valley", "Belle Mine"],
      ["US", "Nevada", "Sutro", "Sutro Ghost Town"],
      ["US", "Nevada", "Tonopah", "Clown Motel"],
      ["US", "Nevada", "Tonopah", "Mizpah Hotel"],
      ["US", "Nevada", "Virginia City", "Beneath the Bonanza"],
      ["US", "Nevada", "Virginia City", "Ghost Adventures Documentary Film"],
      ["US", "Nevada", "Virginia City", "Mackay Mansion"],
      ["US", "Nevada", "Virginia City", "Old Washoe Club and Chollar Mine"],
      ["US", "Nevada", "Virginia City", "Return to Virginia City"],
      ["US", "Nevada", "Virginia City", "Territorial Enterprise"],
      ["US", "Nevada", "Virginia City", "The Washoe Club Final Chapter"],
      ["US", "Nevada", "Virginia City", "Union Brewery of Death"],
      ["US", "Nevada", "Virginia City", "Virginia City"],

      // New Jersey
      ["US", "New Jersey", "Cedar Grove", "Essex County Hospital Center"],

      // New Mexico
      ["US", "New Mexico", "Albuquerque", "Painted Lady Brothel"],
      ["US", "New Mexico", "Cimarron", "St. James Hotel"],
      ["US", "New Mexico", "Deming", "Lewis Flats School"],
      ["US", "New Mexico", "Gallup", "El Rancho Hotel"],
      ["US", "New Mexico", "Las Cruces", "Dona Ana County Courthouse"],
      ["US", "New Mexico", "Las Vegas", "Haunted Harvey House"],
      ["US", "New Mexico", "Mesilla", "Double Eagle Restaurant"],
      ["US", "New Mexico", "Ojo Amarillo", "Skinwalker Canyon"],
      ["US", "New Mexico", "Upper Fruitland", "Upper Fruitland Curse"],

      // New York
      ["US", "New York", "Bethany", "Rolling Hills Asylum"],
      ["US", "New York", "Haverstraw", "Letchworth Village"],
      ["US", "New York", "Manhattan", "Morris Jumel Mansion"],
      ["US", "New York", "Port Washington", "Execution Rocks Lighthouse"],
      ["US", "New York", "Smithtown", "Katie's Bar"],
      ["US", "New York", "Staten Island", "Sailor's Snug Harbor"],

      // North Dakota
      ["US", "North Dakota", "San Haven", "Dakota's Sanatorium of Death"],

      // Ohio
      ["US", "Ohio", "Cincinnati", "Sedamsville Rectory"],
      ["US", "Ohio", "Cleveland", "Franklin Castle"],
      ["US", "Ohio", "Mansfield", "Ohio State Reformatory"],
      ["US", "Ohio", "Newark", "Old Licking County Jail"],
      ["US", "Ohio", "Trinway", "Prospect Place"],

      // Oklahoma
      ["US", "Oklahoma", "Guthrie", "Samaritan Cult House"],
      ["US", "Oklahoma", "Guthrie", "Stone Lion Inn"],
      ["US", "Oklahoma", "Oklahoma City", "Zozo Demon"],
      ["US", "Oklahoma", "Wynnewood", "Horror at Joe Exotic Zoo"],

      // Oregon
      ["US", "Oregon", "Astoria", "Graveyard of the Pacific Astoria Underground"],
      ["US", "Oregon", "Golden", "Golden Ghost Town"],
      ["US", "Oregon", "Pendleton", "Ghost Adventures Buried Souls of Pendleton"],
      ["US", "Oregon", "Portland", "Shanghai Tunnels"],
      ["US", "Oregon", "Turner", "Enchanted Forest"],
      ["US", "Oregon", "Warrenton", "Graveyard of the Pacific Commander's House"],
      ["US", "Oregon", "Wolf Creek", "Wolf Creek Inn"],

      // Pennsylvania
      ["US", "Pennsylvania", "Gettysburg", "Gettysburg Battlefield"],
      ["US", "Pennsylvania", "New Castle", "Hill View Manor"],
      ["US", "Pennsylvania", "Philadelphia", "Eastern State Penitentiary"],
      ["US", "Pennsylvania", "Spring City", "Pennhurst State School"],

      // Rhode Island
      ["US", "Rhode Island", "Harrisville", "Halloween Special Curse of the Harrisville Farmhouse"],

      // South Carolina
      ["US", "South Carolina", "Charleston", "Old Charleston Jail"],

      // South Dakota
      ["US", "South Dakota", "Deadwood", "Halloween Special Deadwood City of Ghosts"],

      // Tennessee
      ["US", "Tennessee", "Adams", "Bell Witch Cave"],
      ["US", "Tennessee", "Fayetteville", "Old Lincoln County Hospital"],
      ["US", "Tennessee", "Haletown", "Hales Bar Marina and Dam"],
      ["US", "Tennessee", "Hurricane Mills", "Loretta Lynn's Plantation House"],

      // Texas
      ["US", "Texas", "Amarillo", "Panic in Amarillo"],
      ["US", "Texas", "Denton", "Halloween Special Route 666"],
      ["US", "Texas", "El Paso", "Halloween Special Route 666"],
      ["US", "Texas", "Huntsville", "Texas Prison Museum"],
      ["US", "Texas", "Mineral Wells", "Crazy Town"],
      ["US", "Texas", "San Antonio", "Black Swan Inn"],
      ["US", "Texas", "San Antonio", "Mission Park train tracks"],
      ["US", "Texas", "Seguin", "Texas Horror Hotel"],
      ["US", "Texas", "Sugar Land", "Central Unit Prison"],
      ["US", "Texas", "Yorktown", "Yorktown Hospital"],

      // Utah
      ["US", "Utah", "Bountiful", "Serial Killer Spirits Ted Bundy Ritual House"],
      ["US", "Utah", "Eureka", "Tintic Mining District"],
      ["US", "Utah", "Great Salt Lake", "Ghost Island"],
      ["US", "Utah", "Great Salt Lake", "The Great Saltair Curse"],
      ["US", "Utah", "Helper", "Carbon County Chaos"],
      ["US", "Utah", "Kaysville", "Kay's Hollow"],
      ["US", "Utah", "Logan Canyon", "St. Ann's Retreat"],
      ["US", "Utah", "Magna", "Witches in Magna"],
      ["US", "Utah", "Millville", "Mayhem in Millville"],
      ["US", "Utah", "Nephi", "Whitmore Mansion"],
      ["US", "Utah", "Ogden", "Ogden Possession"],
      ["US", "Utah", "Ogden", "Terror on 25th Street"],
      ["US", "Utah", "Salt Lake City", "Fear Factory"],
      ["US", "Utah", "Salt Lake City", "Industrial District of the Damned"],
      ["US", "Utah", "Santaquin", "Leslie's Family Tree"],
      ["US", "Utah", "Stansbury Park", "Benson Grist Mill"],
      ["US", "Utah", "Tooele", "Asylum 49"],
      ["US", "Utah", "Tooele", "Tooele Hospital"],
      ["US", "Utah", "Torrey", "Ghost Adventures Skinwalker Invasion"],
      ["US", "Utah", "West Haven", "Haunted Hollow Forest"],

      // Washington
      ["US", "Washington", "Bothell", "Demons in Seattle"],
      ["US", "Washington", "Colfax", "St. Ignatius Hospital"],
      ["US", "Washington", "Ilwaco", "Graveyard of the Pacific Cape Disappointment"],
      ["US", "Washington", "Port Townsend", "Manresa Castle"],
      ["US", "Washington", "Seattle", "Kell's Irish Pub Restaurant"],

      // West Virginia
      ["US", "West Virginia", "Moundsville", "Moundsville Penitentiary"],
      ["US", "West Virginia", "Weston", "Ghost Adventures Live Trans-Allegheny Lunatic Asylum"],
      ["US", "West Virginia", "Weston", "Trans-Allegheny Lunatic Asylum"],

      // Wyoming
      ["US", "Wyoming", "Casper", "Ghost Adventures Mountain of Madness"],
      ["US", "Wyoming", "Rawlins", "Wyoming Frontier Prison"],
    ];

    // =========================
    // HELPERS
    // =========================
    const norm = (s) => (s ?? "").toString().trim().toLowerCase();
    const words = (s) => norm(s).split(/[^a-z0-9]+/).filter(Boolean);

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (c) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[c]));
    }

    function toCSV(rows) {
      const esc = (v) => {
        const s = String(v ?? "");
        return /[\n\r,\"]/g.test(s) ? '"' + s.replaceAll('"','""') + '"' : s;
      };
      return [
        ["country","state_region","city_town","site"].join(","),
        ...rows.map(r => [r.country, r.state, r.city, r.site].map(esc).join(","))
      ].join("\n");
    }

    function download(filename, text) {
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }

    // =========================
    // DATA NORMALIZATION + DEDUPE
    // =========================
    const ALL = (() => {
      const seen = new Set();
      const out = [];
      for (const [country, state, city, site] of RAW) {
        const obj = {
          country: country || "—",
          state: state || "—",
          city: city || "—",
          site: site || "—",
        };
        const key = [obj.country, obj.state, obj.city, obj.site].map(norm).join("|");
        if (seen.has(key)) continue;
        seen.add(key);
        out.push(obj);
      }
      out.sort((a,b) =>
        a.country.localeCompare(b.country) ||
        a.state.localeCompare(b.state) ||
        a.city.localeCompare(b.city) ||
        a.site.localeCompare(b.site)
      );
      return out;
    })();

    // =========================
    // UI STATE
    // =========================
    const els = {
      q: document.getElementById("q"),
      country: document.getElementById("country"),
      state: document.getElementById("state"),
      exact: document.getElementById("exact"),
      clear: document.getElementById("clear"),
      results: document.getElementById("results"),
      matchCount: document.getElementById("matchCount"),
      totalCount: document.getElementById("totalCount"),
      avoidText: document.getElementById("avoidText"),
      copy: document.getElementById("copy"),
      download: document.getElementById("download"),
      resetAvoid: document.getElementById("resetAvoid"),
      check: document.getElementById("check"),
      runCheck: document.getElementById("runCheck"),
      checkOut: document.getElementById("checkOut"),
      themeBtn: document.getElementById("themeBtn"),
      errorBanner: document.getElementById("errorBanner"),
    };

    // =========================
    // THEME
    // =========================
    const THEME_KEY = "ga_theme_v1";
    const THEME_ORDER = ["light", "dark"]; // toggles

    function prefersTheme() {
      try {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'light';
      } catch {
        return 'light';
      }
    }

    function setTheme(theme) {
      const t = THEME_ORDER.includes(theme) ? theme : 'light';
      document.documentElement.setAttribute('data-theme', t);
      els.themeBtn.textContent = `Theme: ${t[0].toUpperCase()}${t.slice(1)}`;
      try { localStorage.setItem(THEME_KEY, t); } catch {}
    }

    function getTheme() {
      try {
        const t = localStorage.getItem(THEME_KEY);
        // migrate old value + default
        if (t === 'system' || !t) return prefersTheme();
        return THEME_ORDER.includes(t) ? t : prefersTheme();
      } catch {
        return prefersTheme();
      }
    }

    function nextTheme(current) {
      return current === 'dark' ? 'light' : 'dark';
    }

    // =========================
    // AVOID LIST
    // =========================
    const AVOID_KEY = "ga_avoid_list_v1";

    const loadAvoid = () => {
      try {
        const raw = localStorage.getItem(AVOID_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      } catch { return []; }
    };

    const saveAvoid = (arr) => {
      try { localStorage.setItem(AVOID_KEY, JSON.stringify(arr)); } catch {}
    };

    let avoid = loadAvoid();

    function avoidKey(r) {
      return [r.country, r.state, r.city, r.site].map(norm).join("|");
    }

    function avoidToText(arr) {
      return arr
        .slice()
        .sort((a,b) =>
          a.country.localeCompare(b.country) ||
          a.state.localeCompare(b.state) ||
          a.city.localeCompare(b.city) ||
          a.site.localeCompare(b.site)
        )
        .map(r => `${r.city} — ${r.site} (${r.state}, ${r.country})`)
        .join("\n");
    }

    function renderAvoid() {
      els.avoidText.value = avoidToText(avoid);
      saveAvoid(avoid);
    }

    // =========================
    // FILTER DROPDOWNS
    // =========================
    function fillCountries() {
      const countries = Array.from(new Set(ALL.map(r => r.country)))
        .sort((a,b)=>a.localeCompare(b));

      els.country.innerHTML = [
        `<option value="">All countries</option>`,
        ...countries.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`)
      ].join("");
    }

    function fillStates(country) {
      const states = Array.from(new Set(
        ALL
          .filter(r => !country || r.country === country)
          .map(r => r.state)
      )).sort((a,b)=>a.localeCompare(b));

      els.state.innerHTML = [
        `<option value="">All states/regions</option>`,
        ...states.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`)
      ].join("");
    }

    // =========================
    // SEARCH
    // =========================
    function matchesRow(row, query, exact) {
      if (!query) return true;
      const hay = `${row.country} ${row.state} ${row.city} ${row.site}`;
      if (!exact) return norm(hay).includes(norm(query));

      const qTokens = words(query);
      if (!qTokens.length) return true;
      const hTokens = new Set(words(hay));
      return qTokens.every(t => hTokens.has(t));
    }

    function filterRows() {
      const q = els.q.value.trim();
      const country = els.country.value || "";
      const state = els.state.value || "";
      const exact = els.exact.checked;

      return ALL.filter(r => {
        if (country && r.country !== country) return false;
        if (state && r.state !== state) return false;
        return matchesRow(r, q, exact);
      });
    }

    function renderResults() {
      const rows = filterRows();
      els.matchCount.textContent = String(rows.length);

      const avoidSet = new Set(avoid.map(avoidKey));

      els.results.innerHTML = rows.map(r => {
        const key = avoidKey(r);
        const inAvoid = avoidSet.has(key);
        return `
          <tr>
            <td>${escapeHtml(r.country)}</td>
            <td>${escapeHtml(r.state)}</td>
            <td>${escapeHtml(r.city)}</td>
            <td>${escapeHtml(r.site)}</td>
            <td class="nowrap">
              <button data-action="avoid" data-key="${escapeHtml(key)}" ${inAvoid ? "disabled" : ""}>
                ${inAvoid ? "Avoided" : "Avoid"}
              </button>
            </td>
          </tr>
        `;
      }).join("");
    }

    function addToAvoidByKey(key) {
      const row = ALL.find(r => avoidKey(r) === key);
      if (!row) return;
      if (avoid.some(a => avoidKey(a) === key)) return;
      avoid.push(row);
      renderAvoid();
      renderResults();
    }

    // =========================
    // DESTINATION CHECKER
    // =========================
    function runDestinationCheck() {
      const q = els.check.value.trim();
      els.checkOut.innerHTML = "";
      if (!q) return;

      const hits = ALL.filter(r => matchesRow(r, q, true));

      if (!hits.length) {
        els.checkOut.innerHTML = `<span class="pill">No exact-ish match found</span><span class="small">Try fewer words (e.g., just the city) or turn off “Exact-ish” in the main search.</span>`;
        return;
      }

      const maxShow = 8;
      const shown = hits.slice(0, maxShow);

      els.checkOut.innerHTML = `
        <span class="pill"><strong>${hits.length}</strong> match${hits.length === 1 ? "" : "es"}</span>
        ${shown.map(r => `<span class="pill">${escapeHtml(r.city)} — ${escapeHtml(r.site)} <span class="muted">(${escapeHtml(r.state)}, ${escapeHtml(r.country)})</span></span>`).join(" ")}
        ${hits.length > maxShow ? `<span class="pill">+${hits.length - maxShow} more</span>` : ""}
      `;
    }

    // =========================
    // SELF TESTS (non-fatal; logs + banner)
    // =========================
    function runSelfTests() {
      const problems = [];
      const assert = (cond, msg) => { if (!cond) problems.push(msg); };

      assert(Array.isArray(RAW) && RAW.length > 0, "RAW dataset is empty.");
      assert(Array.isArray(ALL) && ALL.length > 0, "No locations loaded after normalization.");
      assert(!!els.country && !!els.state, "Country/state select elements not found in DOM.");
      assert(!!els.results, "Results <tbody> not found in DOM.");
      assert(!!els.themeBtn, "Theme button not found in DOM.");

      // Theme sanity
      const t = getTheme();
      assert(THEME_ORDER.includes(t), `getTheme() returned unexpected value: ${t}`);
      setTheme(t);
      assert(THEME_ORDER.includes(document.documentElement.getAttribute('data-theme')), "data-theme was not set to light/dark.");

      // Minimal functional sanity checks
      fillCountries();
      fillStates("");
      assert(els.country.options.length >= 1, "Country dropdown did not populate.");
      assert(els.state.options.length >= 1, "State dropdown did not populate.");

      // Known-location checks (regression tests)
      assert(ALL.some(r => r.city === "Wolf Creek" && /wolf creek inn/i.test(r.site)), "Expected Wolf Creek Inn to be present.");
      assert(ALL.some(r => r.city === "Keeler" && /cerro gordo/i.test(r.site)), "Expected Cerro Gordo to be present.");

      if (problems.length) {
        console.error("Self-tests failed:", problems);
        els.errorBanner.style.display = "block";
        els.errorBanner.textContent = `⚠️ App loaded with ${problems.length} issue(s). Open the console for details.`;
      } else {
        els.errorBanner.style.display = "none";
      }
    }

    // =========================
    // INIT + EVENTS
    // =========================
    els.totalCount.textContent = String(ALL.length);

    // theme init
    let currentTheme = getTheme();
    setTheme(currentTheme);
    els.themeBtn.addEventListener("click", () => {
      currentTheme = nextTheme(currentTheme);
      setTheme(currentTheme);
    });

    // initial render
    fillCountries();
    fillStates("");
    renderAvoid();
    renderResults();
    runSelfTests();

    // filters
    els.country.addEventListener("change", () => {
      fillStates(els.country.value || "");
      els.state.value = "";
      renderResults();
    });

    els.state.addEventListener("change", renderResults);
    els.q.addEventListener("input", renderResults);
    els.exact.addEventListener("change", renderResults);

    els.clear.addEventListener("click", () => {
      els.q.value = "";
      els.country.value = "";
      fillStates("");
      els.state.value = "";
      els.exact.checked = false;
      renderResults();
    });

    // avoid list add
    els.results.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const action = btn.getAttribute("data-action");
      const key = btn.getAttribute("data-key");
      if (action === "avoid" && key) addToAvoidByKey(key);
    });

    // avoid list actions
    els.copy.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(els.avoidText.value);
        els.copy.textContent = "Copied!";
        setTimeout(() => (els.copy.textContent = "Copy"), 900);
      } catch {
        alert("Clipboard copy blocked by your browser. You can still manually select and copy the text.");
      }
    });

    els.download.addEventListener("click", () => {
      download("ghost_adventures_avoid_list.csv", toCSV(avoid));
    });

    els.resetAvoid.addEventListener("click", () => {
      avoid = [];
      renderAvoid();
      renderResults();
    });

    // destination checker
    els.runCheck.addEventListener("click", runDestinationCheck);
    els.check.addEventListener("keydown", (e) => {
      if (e.key === "Enter") runDestinationCheck();
    });
  </script>
</body>
</html>
